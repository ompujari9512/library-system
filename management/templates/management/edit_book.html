{% extends 'management/base.html' %}

{% block content %}
<div class="min-h-screen bg-gray-50 dark:bg-slate-900 flex flex-col font-sans transition-colors duration-300">

    <div class="bg-white dark:bg-slate-800 border-b border-gray-200 dark:border-slate-700 sticky top-0 z-30 shadow-sm flex-none">
        <div class="w-full px-6 md:px-12 py-4 flex items-center justify-between">
            <a href="{% url 'all_books' %}" class="group flex items-center text-lg font-bold text-slate-600 hover:text-amber-600 dark:text-slate-300 dark:hover:text-amber-500 transition-colors">
                <div class="w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-700 group-hover:bg-amber-100 dark:group-hover:bg-amber-900/30 flex items-center justify-center mr-3 transition-colors">
                    <i data-lucide="arrow-left" class="w-5 h-5 transition-transform group-hover:-translate-x-1"></i>
                </div>
                Back to Collection
            </a>
            <span class="text-[10px] font-bold uppercase tracking-widest text-blue-500 border border-blue-200 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-800 px-3 py-1 rounded-full">
                Edit Mode
            </span>
        </div>
    </div>

    <div class="flex-1 flex items-center justify-center p-4 sm:p-6">
        <div class="w-full max-w-4xl bg-white dark:bg-slate-800 rounded-2xl shadow-2xl border border-slate-100 dark:border-slate-700 overflow-hidden flex flex-col md:flex-row">
            
            <div class="md:w-1/3 bg-gradient-to-br from-blue-500 to-indigo-600 p-8 flex flex-col text-white relative overflow-hidden justify-between">
                <div class="absolute top-0 right-0 w-32 h-32 bg-white opacity-10 rounded-full blur-2xl -mr-10 -mt-10"></div>
                
                <div class="relative z-10">
                    <div class="w-12 h-12 bg-white/20 backdrop-blur-md rounded-xl flex items-center justify-center shadow-inner mb-4 text-white border border-white/30">
                        <i data-lucide="edit-3" class="w-6 h-6"></i>
                    </div>
                    <h2 class="text-2xl font-bold mb-2">Edit Book</h2>
                    <p class="text-blue-50 text-xs leading-relaxed font-medium">
                        Update book details, correct typos, or manage inventory stock.
                    </p>
                </div>

                <div class="mt-8 bg-white/10 backdrop-blur-md p-4 rounded-xl border border-white/20 text-center">
                    {% if book.cover_image %}
                        <p class="text-[10px] font-bold text-blue-100 uppercase mb-2">Current Cover</p>
                        <img src="{{ book.cover_image.url }}" class="h-32 mx-auto rounded-lg shadow-md object-cover">
                    {% else %}
                        <div class="h-32 flex items-center justify-center text-blue-200">
                            <i data-lucide="image-off" class="w-10 h-10"></i>
                        </div>
                        <p class="text-[10px] text-blue-200 mt-2">No cover uploaded</p>
                    {% endif %}
                </div>
            </div>

            <div class="md:w-2/3 p-8 relative">
                <form method="POST" enctype="multipart/form-data" class="space-y-5" autocomplete="off">
                    {% csrf_token %}

                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-1">
                            <label class="block text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase">Book Title</label>
                            <input type="text" name="title" value="{{ book.title }}" required 
                                class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-700/50 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:text-white outline-none text-sm font-bold">
                        </div>
                        <div class="space-y-1">
                             <label class="block text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase">Author</label>
                             <input type="text" name="author" value="{{ book.author }}" required 
                                class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-700/50 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:text-white outline-none text-sm font-bold">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                         <div class="space-y-1">
                            <label class="block text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase">ISBN</label>
                            <input type="text" name="isbn" value="{{ book.isbn }}" required 
                                class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-700/50 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:text-white outline-none text-sm font-mono">
                        </div>
                        <div class="space-y-1">
                             <label class="block text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase">Stock Qty</label>
                             <input type="number" name="quantity" value="{{ book.quantity }}" required 
                                class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-700/50 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:text-white outline-none text-sm font-bold">
                        </div>
                    </div>

                    <div class="relative" id="category-dropdown">
                        <label class="block text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase mb-1">Category</label>
                        <input type="hidden" name="category" id="category-hidden-input" value="{{ book.category }}" required>
                        <div class="relative">
                            <input type="text" id="category-search" value="{{ book.category }}" 
                                   class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-700/50 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:text-white outline-none transition cursor-pointer text-sm"
                                   onfocus="toggleDropdown(true)" oninput="filterCategories()">
                            <i data-lucide="chevron-down" class="absolute right-3 top-2.5 w-3.5 h-3.5 text-slate-400 pointer-events-none"></i>
                        </div>
                        <div id="category-list" class="hidden absolute z-50 w-full mt-1 bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-600 rounded-lg shadow-xl max-h-40 overflow-y-auto">
                            <div class="p-1 space-y-0.5" id="category-options"></div>
                        </div>
                    </div>
                    
                    <div class="space-y-1">
                        <label class="block text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase">Format</label>
                         <select name="book_format" class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-700/50 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:text-white outline-none text-sm">
                            <option value="hardcover" {% if book.book_format == 'hardcover' %}selected{% endif %}>Hardcover</option>
                            <option value="paperback" {% if book.book_format == 'paperback' %}selected{% endif %}>Paperback</option>
                            <option value="ebook" {% if book.book_format == 'ebook' %}selected{% endif %}>E-Book</option>
                        </select>
                    </div>

                    <div class="p-3 bg-slate-50 dark:bg-slate-700/30 border border-dashed border-slate-300 dark:border-slate-600 rounded-xl">
                        <label class="block text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase mb-1">Update Cover (Optional)</label>
                        <input type="file" name="cover_image" accept="image/*" class="w-full text-xs text-slate-500 file:mr-3 file:py-1 file:px-2 file:rounded-md file:border-0 file:text-[10px] file:font-bold file:bg-blue-100 file:text-blue-700 hover:file:bg-blue-200"/>
                    </div>

                    <div class="flex justify-end gap-3 pt-2">
                        <a href="{% url 'all_books' %}" class="px-5 py-2.5 rounded-lg text-sm text-slate-500 font-bold hover:bg-slate-100 transition">Cancel</a>
                        <button type="submit" class="px-6 py-2.5 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-bold rounded-lg shadow-lg shadow-blue-500/30 transition flex items-center gap-2 text-sm">
                            <i data-lucide="save" class="w-4 h-4"></i> Update Book
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    lucide.createIcons();
    const categories = ["Fiction", "Non-Fiction", "Science", "Technology", "History", "Biography", "Fantasy", "Mystery", "Romance", "Health", "Business", "Comics", "Art", "Travel"];
    const searchInput = document.getElementById('category-search');
    const hiddenInput = document.getElementById('category-hidden-input');
    const optionsContainer = document.getElementById('category-options');
    const listContainer = document.getElementById('category-list');

    function populateCategories(filterText = '') {
        optionsContainer.innerHTML = '';
        const filtered = categories.filter(c => c.toLowerCase().includes(filterText.toLowerCase()));
        if (filtered.length === 0) {
            const div = document.createElement('div');
            div.className = "px-3 py-2 text-xs text-slate-400 italic cursor-default";
            div.textContent = `Use "${filterText}" as new category`;
            div.onclick = () => selectCategory(filterText);
            optionsContainer.appendChild(div);
        } else {
            filtered.forEach(cat => {
                const div = document.createElement('div');
                div.className = "px-3 py-2 text-xs text-slate-700 dark:text-slate-200 hover:bg-blue-50 dark:hover:bg-blue-900/30 hover:text-blue-600 cursor-pointer rounded-md transition-colors";
                div.textContent = cat;
                div.onclick = () => selectCategory(cat);
                optionsContainer.appendChild(div);
            });
        }
    }
    function selectCategory(value) { searchInput.value = value; hiddenInput.value = value; toggleDropdown(false); }
    function toggleDropdown(show) { if (show) { listContainer.classList.remove('hidden'); populateCategories(searchInput.value); } else { setTimeout(() => listContainer.classList.add('hidden'), 200); } }
    function filterCategories() { populateCategories(searchInput.value); hiddenInput.value = searchInput.value; }
    
    document.addEventListener('click', function(e) { if (!document.getElementById('category-dropdown').contains(e.target)) toggleDropdown(false); });
</script>
{% endblock %}